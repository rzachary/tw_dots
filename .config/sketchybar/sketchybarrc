#!/bin/bash

# Define plugin directory
PLUGIN_DIR="$CONFIG_DIR/plugins"

##### Bar Appearance #####
sketchybar --bar \
           position=top \
           height=38 \
           blur_radius=30 \
           color=0x40000000 \
           padding_left=10 \
           padding_right=10 \
           y_offset=0 \
           margin=0

##### Default Settings #####
default=(
  padding_left=5
  padding_right=5
  background.height=26
  background.corner_radius=9
  background.border_width=0
  icon.font="SF Pro:Bold:15.0"
  icon.color=0xffffffff
  icon.padding_left=5
  icon.padding_right=5
  label.font="SF Pro:Semibold:13.0"
  label.color=0xffffffff
  label.padding_left=5
  label.padding_right=5
  label.y_offset=0
  icon.y_offset=0
)

sketchybar --default "${default[@]}"

##### Add Aerospace Workspace Event #####
sketchybar --add event aerospace_workspace_change

##### Workspace Indicators #####
# Get current workspaces from aerospace
for sid in $(/opt/homebrew/bin/aerospace list-workspaces --all); do
    sketchybar --add item space.$sid left \
               --set space.$sid \
                   background.color=0x40ffffff \
                   background.corner_radius=9 \
                   background.height=26 \
                   label="$sid" \
                   click_script="/opt/homebrew/bin/aerospace workspace $sid" \
                   script="$PLUGIN_DIR/aerospace.sh" \
               --subscribe space.$sid aerospace_workspace_change
done

##### Left Items #####
# Add Apple Logo
sketchybar --add item apple.logo left \
           --set apple.logo \
               icon= \
               icon.font="SF Pro:Black:15.0" \
               label.drawing=off \
               padding_right=10 \
               click_script="sketchybar --trigger apple_menu"

# Add Front App Indicator
sketchybar --add item front_app left \
           --set front_app \
               icon.drawing=on \
               label.drawing=on \
               script="$PLUGIN_DIR/front_app.sh" \
               background.color=0x40ffffff \
               background.corner_radius=9 \
               background.height=26 \
               label.padding_right=10 \
           --subscribe front_app front_app_switched

##### Center Items #####
# Add neovim mode indicator (for use with tmux/neovim)
sketchybar --add item vim_mode center \
           --set vim_mode \
               icon= \
               label="NORMAL" \
               background.color=0x40ffffff \
               background.corner_radius=9 \
               background.height=26 \
               script="$PLUGIN_DIR/vim_mode.sh"

##### Right Items #####
# Add Memory Usage
sketchybar --add item memory right \
           --set memory \
               icon=󰍛 \
               update_freq=10 \
               script="$PLUGIN_DIR/memory.sh" \
               background.color=0x40ffffff \
               background.corner_radius=9 \
               background.height=26

# Add CPU Usage
sketchybar --add item cpu right \
           --set cpu \
               icon=󰘚 \
               update_freq=10 \
               script="$PLUGIN_DIR/cpu.sh" \
               background.color=0x40ffffff \
               background.corner_radius=9 \
               background.height=26

# Time Widget
sketchybar --add item clock right \
           --set clock \
               update_freq=10 \
               icon=󰅐 \
               script="$PLUGIN_DIR/clock.sh" \
               background.color=0x40ffffff \
               background.corner_radius=9 \
               background.height=26

# Volume Widget
sketchybar --add item volume right \
           --set volume \
               icon=󰕾 \
               script="$PLUGIN_DIR/volume.sh" \
               background.color=0x40ffffff \
               background.corner_radius=9 \
               background.height=26 \
           --subscribe volume volume_change

# Battery Widget
sketchybar --add item battery right \
           --set battery \
               update_freq=120 \
               icon=󰁹 \
               script="$PLUGIN_DIR/battery.sh" \
               background.color=0x40ffffff \
               background.corner_radius=9 \
               background.height=26 \
           --subscribe battery system_woke power_source_change

##### Update Command #####
sketchybar --update
